# 8-1. 네트워킹(Networking)

## Explore Environment

### Cluster Networking

+ 마스터노드 <-> 워크노드에는 network에 연결된 network interface가 1개 이상 있음

+ 각 interfacedp는 주소가 설정되어야 함

+ host에는 각각의 host 이름 + MAC 주소가 설정되어야 함

  | 마스터노드                                       | 6443 for the API server |
  | ------------------------------------------------ | ----------------------- |
  | kubelets on the master and worker node           | 10250                   |
  | kube-scheduler                                   | 10251                   |
  | kube-controller-manager                          | 10252                   |
  | (외부 접근을 위해) 워커노드를 서비스에 노출할 때 | 30000 ~ 32767           |
  | ETCD 서버                                        | 2379                    |

+ 관련 명령어

  + ip 주소 + 특성에 관한 정보 조회: `ip addr` / `ip a`

    <img src="https://user-images.githubusercontent.com/33214969/161440566-1150c076-ae46-4b2d-8b70-4810b478c587.png" alt="Network - 명령어(ip addr).png" width="50%;" />

  + 모든 네트워크 Interface/Bridge 조회 : `ip link`

    <img src="https://user-images.githubusercontent.com/33214969/161440570-41e7d156-f1b0-48eb-bd6a-5ab0187f1929.png" alt="Network - 명령어(ip link).png" width="50%;" />

    + 마스터 노드 상의의 인터페이스의 MAC 주소 조회 : `ip link show [ip]`

      <img src="https://user-images.githubusercontent.com/33214969/161440569-379b3606-ae5a-40b9-bb34-ce31d7e5593c.png" alt="Network - 명령어(ip link show).png" width="50%;" />

  + route 테이블 조회 : `ip route` /  `ip route show [Gateway명]`

    <img src="https://user-images.githubusercontent.com/33214969/161440572-a8fc9276-0dde-4962-8097-83a17ee3c4c0.png" alt="Network - 명령어(ip route).png" width="50%;" />

    <img src="https://user-images.githubusercontent.com/33214969/161440571-328806ea-c4dc-47fe-8f9c-236f309eeabb.png" alt="Network - 명령어(ip route show).png" width="30%;" />

  + ip forward 조회 : `cat /proc/sys/net/ipv4/ip_forward`

    <img src="https://user-images.githubusercontent.com/33214969/161440568-87edba65-e80b-4712-ac32-f22e5d4d9907.png" alt="Network - 명령어(ip forward).png" width="40%;" />

  + 노드의 IP/MAC 주소 확인 : `arp [node명]`

    <img src="https://user-images.githubusercontent.com/33214969/161440563-382a832e-8f01-4a8e-a475-7c28ed24184e.png" alt="Network - 명령어(arp).png" width="50%;" />

  + ip/port 확인 : `netstat -nplt`

    <img src="https://user-images.githubusercontent.com/33214969/161440574-474bf0f7-01e9-41c5-a35d-e1ae167a4374.png" alt="Network - 명령어(netstat -nplt).png" width="50%;" />

  + 접속 확인 : `netstat -anp | grep [확인할 프로그램명]`

    <img src="https://user-images.githubusercontent.com/33214969/161440573-33cdbef4-2dd5-4ee7-8706-11709bd9e14c.png" alt="Network - 명령어(netstat -anp).png" width="50%;" />

  + **netstat 옵션**

    + -a 옵션 : 현재 다른 PC와 연결되어 있거나 대기(Listening) 중인 모든 port 확인
    + -r 옵션 : 라우팅 테이블 확인 / 커넥션되어 있는 port 확인
    + -n 옵션 : 현재 다른 PC와 연결되어 있는 port 확인
    + -e 옵션 : 랜카드에서 송수신한 패킷의 용량/종류 확인
    + -s 옵션 : IP, ICMP, UDP 프로토콜별 상태 확인
    + -t 옵션 : tcp protocol
    + -u 옵션 : udp protocol
    + -p 옵션 : 프로토콜 사용 Process ID 확인
    + ic 옵션 : 1초 단위로 보여줌

<br/><br/>
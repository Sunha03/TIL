# 6-2. 보안(Security)

## Authorization

```tex
▫️ 사용자가 클러스터에 접근하여 할 수 있는 것을 정의함
```

+ 권한 부여 메커니즘

  ### Node authorization

  + kubelet은 apiserver에 접근하여 service, endpoint, node, pod의 정보를 읽거나 node 상태와 같은 정보를 apiserver에 전달함. 이러한 요청은 node authorizer의해 처리됨
  + 사용자 이름이 system:nodes 그룹에 속해야 함

  <br/>

  ### Attribute based authorization

  + 사용자 or 사용자 그룹을 권한 집합과 연결시키는 방법
  + json 형식의 정책 집합 파일을 생성하여 apiserver에 전달함. 변경/추가가 필요할 때마다 파일 수정 후 apiserver를 재시작해야 함.

  <br/>

  ### Role based authorization

  + 권한 집합으로 역할을 생성하여 사용자를 역할에 연결시키는 방법
  + 변경이 필요한 경우 역할을 수정하는 식으로 반영할 수 있음

  <br/>

  ### Webhook

  + 외부에서 인증을 관리하는 방법
  + 사용자 정보와 요청 정보를 이용해 인증 agent의 API를 호출하여 승인 여부를 결정함
  + API response에 기반하여 접근을 제어함

  <br/>

  ### AlwaysAllow

  + 모든 요청을 인증 없이 허용하는 방식

  <br/>

  ### AlwaysDeny

  + 모든 요청을 거부하는 방식

  <br/>

+ 권한 부여 메커니즘은 kube-apiserver에서 `--authorization-mode` 옵션을 사용하여 설정(default : AlwaysAllow)

  + 메커니즘은 쉼표로 구분하여 여러 메커니즘 사용하도록 설정 가능함 → 선언된 순서대로 동작함

  + 요청을 거부하면 다음 승인 메커니즘이 동작하며, 요청을 승인하면 다음 인증 메커니즘은 동작하지 않음

  + yaml 파일

    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      creationTimestamp: null
      name: kube-apiserver
      namespace: kube-system
    spec:
      containers:
      - command:
        - kube-apiserver
        - --authorization-mode=Node,RBAC    # 권한 부여 메커니즘 설정
        ...
    ```

    